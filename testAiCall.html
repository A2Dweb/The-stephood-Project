<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>The Stephood Project- Voice</title>
    <script
      id="retell-widget"
      src="https://dashboard.retellai.com/retell-widget.js"
      data-public-key="key_77e8a0c328573f505410e21becaf"
      data-agent-id="agent_b0cc0fee7562f7428c5318778a"
      data-agent-version="0"
      data-title="Chat with us!"
    ></script>
  </head>
  <body>
  <div>
    <h1> Test AI Voice Call</h1>
    <button id="startCall">Start Voice Call</button>
    <button id="stopCall" disabled>Stop Call</button>
    <div id="status">Ready to start call</div>
    <div id="transcript"></div>
  </div>

  <script type="module">
    import { RetellWebClient } from 'https://cdn.skypack.dev/retell-client-js-sdk';
    
    const retellWebClient = new RetellWebClient();
    const startButton = document.getElementById('startCall');
    const stopButton = document.getElementById('stopCall');
    const status = document.getElementById('status');
    const transcript = document.getElementById('transcript');

    startButton.addEventListener('click', async () => {
      try {
        const response = await fetch('https://api.retellai.com/v2/create-web-call', {
          method: 'POST',
          headers: {
            Authorization: `Bearer key_77e8a0c328573f505410e21becaf`, 
            'Content-Type': 'application/json' },
          body: JSON.stringify({ agent_id: 'agent_8153f1e1832536d8fa08b5da6b' })
        });
        
        const callData = await response.json();
        
        await retellWebClient.startCall({
          accessToken: callData.access_token,
        });
        
        startButton.disabled = true;
        stopButton.disabled = false;
        status.textContent = 'Call starting...';
      } catch (error) {
        console.error('Error starting call:', error);
        status.textContent = 'Error starting call';
      }
    });

    stopButton.addEventListener('click', () => {
      retellWebClient.stopCall();
    });

    // Event listeners
    retellWebClient.on("call_started", () => {
      status.textContent = 'Call active - speak now!';
    });

    retellWebClient.on("call_ended", () => {
      status.textContent = 'Call ended';
      startButton.disabled = false;
      stopButton.disabled = true;
    });

    retellWebClient.on("update", (update) => {
      if (update.transcript) {
        transcript.innerHTML = update.transcript.replace(/\n/g, '<br>');
      }
    });

    retellWebClient.on("error", (error) => {
      console.error("Call error:", error);
      status.textContent = 'Call error occurred';
      retellWebClient.stopCall();
    });
  </script>
</body>

</html>